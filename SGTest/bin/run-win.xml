
<project name="sgtest-runner" default="testsummary" basedir=".">

    <!-- import user properties -->
    <loadproperties srcfile="run.properties"/>

    <!-- sgtest properties -->
    <property name="sgtest.homedir" value="${basedir}/../"/>
    <property name="sgtest.jar.name" value="gs-sgtest.jar"/>
    <property name="sgtest.jar" value="${sgtest.homedir}lib/${sgtest.jar.name}"/>
    <property name="testng.tmp.reports.dir" value="${sgtest.homedir}/tmp-reports"/>
    <property name="testng.summary.dir" value="${sgtest.homedir}/deploy/local-builds/${BUILD_NUMBER}/${SUITE_NAME}"/>
    <property name="tmp.testng.classes" value="${sgtest.homedir}/tmp"/>

	
    <!-- classpath -->
    <path id="classpath">
	
        <!-- using all jars found in homedir/lib/ext -->
        <fileset dir="${sgtest.homedir}/lib/testng">
            <include name="**/*.jar"/>
        </fileset>

        <!-- commons jars -->
        <fileset dir="${sgtest.homedir}/lib/commons">
            <include name="**/*.jar"/>
        </fileset>

        <!-- hamcrest jars -->
        <fileset dir="${sgtest.homedir}/lib/hamcrest">
            <include name="**/*.jar"/>
        </fileset>

        <!-- hsql jar -->
        <fileset dir="${sgtest.homedir}/lib/hsql">
            <include name="**/*.jar"/>
        </fileset>

        <!-- xml jars -->
        <fileset dir="${sgtest.homedir}/lib/xml">
            <include name="**/*.jar"/>
        </fileset>

        <fileset dir="${BUILD_DIR}/lib/required">
            <include name="**/*.jar"/>
        </fileset>

		<!-- hiberbate jars -->
        <fileset dir="${sgtest.homedir}/lib/hibernate">
            <include name="**/*.jar"/>
        </fileset>
    	
    	<!-- spring jars -->
        <fileset dir="${sgtest.homedir}/lib/spring">
            <include name="**/*.jar"/>
        </fileset>

		<!-- Jsch jars -->
		<fileset dir="${sgtest.homedir}/lib/jsch">
			<include name="**/*.jar"/>
		</fileset>
				
		<!-- XenServer jars -->
		<fileset dir="${sgtest.homedir}/lib/xenserver">
			<include name="**/*.jar"/>
		</fileset>

		<!-- Selenium jars -->
		<fileset dir="${sgtest.homedir}/lib/selenium">
			<include name="**/*.jar"/>
		</fileset>
    	
		<!-- Webui jars -->
		<fileset dir="${sgtest.homedir}/tmp">
			<include name="**/*.jar"/>
		</fileset>

		<!-- UMS jars -->
    		<fileset dir="${BUILD_DIR}/lib/platform/usm">
			<include name="**/usm.jar"/>
		</fileset>
		
		<!-- cli jars -->
		<fileset dir="${BUILD_DIR}/tools/cli">
			<include name="**/*.jar"/>
		</fileset>

		
		<!-- simplejavaprocessjars -->
		<fileset dir="${sgtest.homedir}/apps/USM/usm/simplejavaprocess">
			<include name="**/*.jar"/>
		</fileset>

		<!-- sigar jars -->
		<fileset dir="${BUILD_DIR}/lib/platform/sigar">
        	<include name="**/*.jar"/>
    	</fileset>
		
		<!-- groovy jars -->
		<fileset dir="${BUILD_DIR}/tools/groovy/lib">
	        	<include name="**/groovy*.jar"/>
			<include name="**/commons-logging*.jar"/>
			<include name="**/bsf*.jar"/>
	    	</fileset>			

		<!-- mail jars -->
		<fileset dir="${sgtest.homedir}/lib/mail">
        	<include name="**/*.jar"/>
		</fileset>
    	
		 <!-- wiki jars -->
      	 <fileset dir="${sgtest.homedir}/lib/wiki">
          	<include name="**/*.jar"/>
      	 </fileset>

		 <!-- xstream jars -->
      	 <fileset dir="${sgtest.homedir}/lib/xstream">
          	<include name="**/*.jar"/>
      	 </fileset>
      	 
      	<!-- jackson jars -->
        <fileset dir="${sgtest.homedir}/lib/jackson">
            <include name="**/*.jar"/>
        </fileset>

        <!-- jgit jars -->
        <fileset dir="${sgtest.homedir}/lib/jgit">
            <include name="**/*.jar"/>
        </fileset>

        <!-- jclouds jars -->
        <fileset dir="${sgtest.homedir}/lib/jclouds">
            <include name="**/*.jar"/>
        </fileset>


		<dirset dir="${sgtest.homedir}/config"/>
    	
        <dirset dir="${tmp.testng.classes}/apps"/>
		
		<pathelement location="${sgtest.jar}"/>

    </path>

    <!--
         Run test suite and generate test summary.
    -->
    <target name="testsummary" description="Run tests and generate test summary">
        <mkdir dir="${testng.summary.dir}"/>
	 <taskdef resource="testngtasks" classpathref="classpath"/>
        <testng suitename="${SUITE_NAME}${SUITE_ID}" testname="${SUITE_NAME}${SUITE_ID}" classpathref="classpath" outputDir="${testng.summary.dir}"
                haltOnfailure="false" useDefaultListeners="false"
    		listeners="framework.testng.SGTestNGListener, framework.testng.SGTestNgSuiteSplitter, framework.testng.report.TestNgReporterImpl">
            <jvmarg line="-Djava.security.policy=policy/policy.all -Djava.awt.headless=true -Xmx1024m -XX:MaxPermSize=512m"/>
            <classfileset dir="${tmp.testng.classes}" includes="${INCLUDE}" excludes="${EXCLUDE}"/>
        	<sysproperty key="selenium.browser" value="${SELENIUM_BROWSER}"/>
            <sysproperty key="sgtest.suiteId" value="${SUITE_ID}"/>
       	    <sysproperty key="sgtest.numOfSuites" value="${SUITE_NUMBER}"/>	
        	<sysproperty key="com.gs.logging.level.config" value="true"/>
        	<sysproperty key="org.apache.commons.logging.Log" value="org.apache.commons.logging.impl.Jdk14Logger"/>
        	<sysproperty key="java.util.logging.config.file" value="${sgtest.homedir}/config/sgtest_logging.properties"/>
            <sysproperty key="sgtest.buildFolder" value="${sgtest.homedir}/deploy/local-builds/${BUILD_NUMBER}"/>
            <sysproperty key="sgtest.url" value="http://192.168.9.121:8087/sgtest2.0-cloudify/"/>
 
        </testng>
    </target>

</project>